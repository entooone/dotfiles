#!/bin/bash

MEMODIR=$HOME/.memo

if [ ! -e ${MEMODIR} ]; then
    mkdir ${MEMODIR}
fi

if [ "$1" = "c" ]; then
  (cd ${MEMODIR}; cat `ls -1 .`)
elif [ "$1" = "l" ]; then
  ls -1 ${MEMODIR}
elif [ "$1" = "t" ]; then
  for f in ${MEMODIR}/*; do
    result=$(egrep -nir "^ *todo" $f)
    if [ $? -eq 0 ]; then
      echo "*** ${f#${MEMODIR}/} ***"
      echo "$result" | perl -pe 's/^([0-9]+): *todo *:? */   L\1: /ig'
    fi  
  done
elif [ $# -eq 1 ]; then
  vim + ${MEMODIR}/*$1*
elif [ $# -eq 2 ]; then
  vim +$2 ${MEMODIR}/*$1*
else
  filename=memo_$(date "+%Y%m%d").md
  filepath=${MEMODIR}/$filename
  
  if [ -e $filepath ]; then
    echo "" >> $filepath
  fi  
  echo -e "## $(date '+%Y%m%d %H:%M:%S')\n\n" >> $filepath
  
  (cd ${MEMODIR} && vim + $filepath)
fi
